# Squashed

# Connection

We start by checking the connection with the machine:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled.png)

# Enumeration

Knowing we have connection with the machine we enumerate the open ports.

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%201.png)

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%202.png)

Now we know the open ports. We see the open port 2049 that is running nfs, with [hacktricks](https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting) we can get different information about the service.

# NFS

NFS is a client/server system that allows users to access files across a network and treat them as if they resided in a local file directory. It has the same purpose as SMB but it cannot talk to SMB. NFS has **no mechanism for authentication** or **authorization.** 

With the command ‘showmount’ we can get different folders taht we can get:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%203.png)

And we mount this two folders in our local machine,

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%204.png)

and check the content

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%205.png)

We see that the web_server directory seems to be empty, but this is not true, what is happening is that we don’t have permission to read these files:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%206.png)

As we see here we are not the user with 2017 id but we can create it locally and bypass this.

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%207.png)

Now logged as this user we can access this folder.

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%208.png)

Here we see all the content of the webserver directory. Now we need to think how to use this to get access to the machine, so we can modify the code in order to generate a reverse shell when a connection to the server is performed. We can create a php file to execute commands in the tarject machine:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%209.png)

And now in the browser:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2010.png)

With this we get a shell in the machine as user alex, and with this we can go to alex home directory and get the user flag (user.txt)

Now we need to get root privileges, and with sudo su we are not able because of the password.

We can check the users connected in the machine:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2011.png)

As ross is connected and we have their home directory mount in our machine we can check its content:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2012.png)

And discover a .Xauthority file. The file . Xauthority is generated by the xauth program. It is an authentication system for graphical applications. This allows you to prevent other people from sending images, other windows on your screen - but also prevent other people from "seeing" what's on your screen.

We can’t access to this file in order to we are not 1001 user, so we create a new user 1001 and access to the file 

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2013.png)

This is not really readable, so what we want now is to send this file to the session opened in the target machine, by doing that we will have an authority for alex user. To do this we mount a http server on port 8080 in our machine, and from target we download the .Xauthority file and set the value: 

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2014.png)

With this session authority we can see what ross is doing with:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2015.png)

as we save this file in /var/www/html we can acces from our machine and see the image:

![Untitled](Squashed%20cc44552a55b64abe8e25a0f1c41af2ef/Untitled%2016.png)

From here we get the root password and access to get the flag.